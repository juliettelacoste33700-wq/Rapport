<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VisitHome â€¢ Rapport (PWA local-first)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --peche:#FFEDE6; --framboise:#DD183B; --gris:#4b5563; --noir:#111; }
    html,body{margin:0;background:#fafafa;color:var(--noir);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    .container{max-width:980px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #eee;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .titlebar{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #eee;background:linear-gradient(180deg,#fff 0,#fff 65%,#fff0 100%),var(--peche)}
    .titlebar h1{margin:0;font-size:22px}
    .badge{display:inline-block;background:var(--peche);color:#8a0f22;border:1px dashed #f4c4bc;padding:6px 10px;border-radius:999px;font-size:12px}
    .section{padding:20px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
    label{font-size:13px;color:var(--gris);display:block;margin:8px 0 6px}
    input[type=text],input[type=number],textarea,select{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:12px;background:#fff}
    textarea{min-height:92px;resize:vertical}
    input[type=file]{margin-top:6px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer}
    .btn.primary{background:var(--framboise);color:#fff;border-color:var(--framboise)}
    .btn.warn{background:#fff3f3;color:#8a0f22;border-color:#ffd6d6}
    .map-note{background:var(--peche);border:1px dashed #f3c3bc;padding:10px;border-radius:12px;margin-top:6px}
    .hr{height:1px;background:#eee;margin:12px 0}
    .logo-preview{height:64px;aspect-ratio:1/1;border-radius:10px;border:1px solid #eee;display:grid;place-items:center;background:#fff;overflow:hidden}
    .logo-preview img{max-height:100%;max-width:100%}
    .footer{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}
    .room{border:1px dashed #e5e7eb;padding:14px;border-radius:14px;margin-top:12px;background:#fff}
    .muted{color:#6b7280}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #eee;border-radius:999px;background:#fff}
    .toc{font-size:13px;color:#374151;background:#fff;border:1px solid #eee;border-radius:12px;padding:10px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;cursor:pointer}
    .statusbar{display:flex;gap:10px;align-items:center;font-size:12px;color:#4b5563;margin-top:8px}
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.off{background:#f43f5e}
    .dot.on{background:#10b981}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/vfs_fonts.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="container card">
    <div class="titlebar">
      <h1>VisitHome â€” GÃ©nÃ©rateur de Rapport (PWA, offline)</h1>
      <div>
        <span class="badge" id="offlineBadge"><span class="dot on" id="netDot"></span> Statut : <strong id="netTxt">En ligne</strong></span>
      </div>
    </div>
    <div class="section">

      <!-- Logo + titre -->
      <div class="row">
        <div>
          <label>Logo (PNG/JPG)</label>
          <div class="pill">
            <input type="file" id="logo" accept="image/*" />
            <div class="logo-preview" id="logoPreview">Logo</div>
          </div>
        </div>
        <div>
          <label>Titre du rapport</label>
          <input id="titre" type="text" placeholder="Ex. T3 Bordeaux â€” Esprit des Lois" />
        </div>
      </div>

      <!-- Adresse + infos -->
      <div class="row">
        <div>
          <label>Adresse du bien</label>
          <input id="adresse" type="text" placeholder="NÂ°, Rue, Ville" />
        </div>
        <div class="row-3">
          <div>
            <label>Surface (mÂ²)</label>
            <input id="surface" type="number" step="0.1" placeholder="65" />
          </div>
          <div>
            <label>Prix (â‚¬)</label>
            <input id="prix" type="number" step="1" placeholder="89000" />
          </div>
          <div>
            <label>Date de visite</label>
            <input id="dateVisite" type="text" placeholder="jj/mm/aaaa" />
          </div>
        </div>
      </div>

      <!-- Map API -->
      <div class="row">
        <div>
          <label>ClÃ© API carte (Google Static Maps ou MapTiler)</label>
          <input id="mapKey" type="text" placeholder="colle ta clÃ© API (facultatif)" />
        </div>
        <div>
          <label>Fournisseur de carte</label>
          <select id="mapProvider">
            <option value="google">Google Static Maps</option>
            <option value="maptiler">MapTiler Static</option>
          </select>
        </div>
      </div>

      <div class="map-note"><strong>Plan / situation :</strong> le PDF inclura un QR code sous lâ€™en-tÃªte. Si tu saisis une clÃ© API, on ajoute aussi lâ€™image de la carte directement dans le PDF.</div>

      <!-- Disclaimer -->
      <div class="hr"></div>
      <label>Disclaimer (sera mis en avant dans le PDF)</label>
      <textarea id="disclaimer"></textarea>

      <!-- Descriptif -->
      <label style="margin-top:14px">Descriptif gÃ©nÃ©ral</label>
      <textarea id="descGeneral" placeholder="Ã‰tat gÃ©nÃ©ral, atouts, points de vigilance, environnementâ€¦"></textarea>

      <div class="hr"></div>
      <div class="chips">
        <button class="chip" id="quickCuisine">+ Cuisine</button>
        <button class="chip" id="quickChambre">+ Chambre</button>
        <button class="chip" id="quickSdb">+ SDB</button>
      </div>

      <h2 style="margin-top:8px">PiÃ¨ces & photos</h2>
      <div id="rooms"></div>
      <button class="btn" id="addRoomBtn">+ Ajouter une piÃ¨ce</button>

      <div class="footer">
        <button class="btn" id="installBtn" title="Installer l'application">ðŸ“² Installer</button>
        <button class="btn" id="saveDraftBtn">ðŸ’¾ Sauvegarder</button>
        <button class="btn" id="loadDraftBtn">ðŸ“‚ Charger</button>
        <button class="btn warn" id="clearBtn">ðŸ§¹ Vider (appareil)</button>
        <button class="btn primary" id="generateBtn">ðŸ“„ GÃ©nÃ©rer le PDF</button>
      </div>

      <div class="statusbar">
        <div id="saveStatus">â€”</div>
      </div>

      <div class="hr"></div>
      <div class="toc" id="tocHint">Sommaire : gÃ©nÃ©rÃ© automatiquement dans le PDF (avec numÃ©ros de pages).</div>
    </div>
  </div>

  <div id="toast" style="position:fixed;right:16px;bottom:16px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:all .25s"></div>

<script>
// Texte par dÃ©faut du disclaimer (premium styling)
const disclaimerDefault = `Informations importantes

Le prÃ©sent rapport est Ã©tabli par VisitHome Ã  la demande exclusive du client.
Il a pour objet de fournir un constat factuel et objectif de lâ€™Ã©tat du bien immobilier visitÃ©, sur la base des observations visuelles et des informations disponibles lors de la visite.

VisitHome nâ€™est ni une agence immobiliÃ¨re, ni un expert agrÃ©Ã©, ni un diagnostiqueur certifiÃ©. Aucune activitÃ© dâ€™intermÃ©diation, de nÃ©gociation ou de transaction immobiliÃ¨re nâ€™est rÃ©alisÃ©e. VisitHome ne joue en aucun cas le rÃ´le de mandataire entre le propriÃ©taire/bailleur et le client.

Le client conserve son libre arbitre dans la dÃ©cision de louer ou dâ€™acheter le bien et demeure responsable de toute vÃ©rification complÃ©mentaire (diagnostics rÃ©glementaires, conformitÃ© technique, Ã©tat juridique, conditions financiÃ¨res, etc.).

Les constats prÃ©sentÃ©s reflÃ¨tent uniquement la situation observÃ©e Ã  la date de la visite. Ils ne sauraient constituer une garantie dâ€™Ã©tat, ni engager VisitHome au-delÃ  de cette mission de compte-rendu.

VisitHome recommande au client de prendre toutes mesures de prudence habituelles avant tout engagement (consultation des documents officiels, diagnostics, rÃ¨glements de copropriÃ©tÃ©, servitudes, acte notariÃ©, etc.).

Nous espÃ©rons que ce rapport contribuera Ã  un choix Ã©clairÃ© et serein de votre part.
VisitHome vous remercie pour votre confiance et vous souhaite pleine rÃ©ussite dans votre dÃ©marche.`;

// injection du disclaimer par dÃ©faut si vide
window.addEventListener('DOMContentLoaded', ()=>{
  const el=document.getElementById('disclaimer');
  if(el && !el.value){ el.value=disclaimerDefault; }
});

// Style premium pour le PDF
function styleDisclaimer(text){
  return {
    table:{ widths:['*'], body:[[ { text:text, fontSize:10, italics:true, fillColor:'#F9FAFB', color:'#374151', margin:[8,6,8,6] } ]] },
    layout:{ hLineWidth:()=>0, vLineWidth:()=>0, paddingLeft:()=>0, paddingRight:()=>0, paddingTop:()=>0, paddingBottom:()=>0 },
    margin:[0,4,0,8]
  };
}
</script>
</body>
</html>
